# 嫦娥五号月壤颗粒矿物自动分割识别算法
[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
本研究基于光片样背散射电子图的灰度特征和能量色散谱图的元素相对密度特征，设计并实现了一种月壤矿物自动识别算法，适用于月球样品矿物的快速分析。
## 功能特点
- **高效**：批量实现月壤矿物自动分类。
- **易用**：简单易上手。


## 快速开始
1. **安装依赖**：
   ```bash
   pip install -r requirements.txt
   ```

2. **运行脚本**：
   ```bash
   python kwfl.py
   ```

## 输入/输出
- **输入**：
      位置：kwfl.py同文件夹下
-       新建文件夹“orgpic”，存放背散射电子图灰度特征（.tiff文件）。
-       新建文件夹“duibi”，存放能量色散谱图的元素相对密度特征（.tiff文件）。
- **输出**：
- **“biaoge”文件夹：**```包含文件fig_n.png、fig_n_T.png、汇总表—-密度范围.csv、汇总表—-密度均值.csv文件。```
    *fig_n.png*：`绘制同灰度下不同小块的元素含量波动情况，其中横坐标为灰度块下小块编号，纵坐标为元素含量、n表示第n个灰度块。`
    *fig_n_T.png*：`为fig_n.png的转置，绘制某元素在同灰度下不同小块上的变化情况情况，其中横坐标为元素种类，纵坐标为元素含量、n表示第n个灰度块。`
    *汇总表—-密度范围.csv*：`包含该电镜图划分的每一种灰度下的每一编号小块：对应的各个元素的含量范围信息、每一编号小块面积占比信息、每一编号小块对应灰度信息、每一编号小块划分的矿物结果信息。`
    *汇总表—-密度均值.csv*：`与“汇总表—-密度范围.csv”区别在于该表格每一编号小块的元素信息取均值而不是范围。包含该电镜图划分的每一种灰度下的每一编号小块：对应的各个元素的含量均值信息、每一编号小块面积占比信息、每一编号小块对应灰度信息、每一编号小块划分的矿物结果信息。`
- **“blackbg_mdf”文件夹：**```包含背散射电子图灰度特征的.png文件。```
- **“{电镜图名称}”文件夹：**```包含背散射电子图灰度特征划分后，各个灰度黑白转置的.png文件。```
- **“duibi1”文件夹：**```包含能量色散谱图的元素相对密度特征的.png文件。```
- **“duibi2”文件夹：**```包含能量色散谱图的元素相对密度特征调整亮度和对比度之后的.png文件。```
- **“Grayscale”文件夹：**```包含背散射电子图灰度特征划分后，各个灰度下的.png文件。```
- **“julei”文件夹：**```包含各个灰度文件夹，灰度文件夹下有每一种元素二分类结果的.png文件，每一元素下二分类结果中每一类的元素密度范围、密度均值和每一类的面积占比的总结.doc文件。```
-  **“same_element”文件夹：**```包含各个灰度文件夹、高P区域文件夹、元素分类结果可视化的.png文件，其中“G1”—“G6”表示灰度1—6。灰度文件夹下有所有元素二分类结果全排列相同块号可视化的.png文件，每一灰度下所有元素二分类结果全排列相同块号可视化汇总的.png文件，每一灰度下所有元素分类后相同元素密度块号的.doc文件。高P区域文件夹下包括每一灰度下P元素含量较高区域可视化的.png文件和高P元素区域汇总可视化的.png文件。图“all.png”，是“G1”—“G6”的整合，不包含高P区域。用以看各灰度各矿的分布。```
 -  **“SPOTSALL”文件夹：**```包含各个灰度文件夹，各个灰度文件夹下为按每一种元素存储的.pkl文件，其中存放各个元素按块号顺序存储的每一小块中该元素的密度值。```
 -  **“yuan”文件夹：**```包含背散射电子图灰度特征的.jpg文件、.png文件。和背景透明的.png文件。```

 

## 注意事项
- **所有路径不要有空格，不要有非法字符。**
- **kwfl.py所分析的能量色散谱图的元素相对密度特征为以下12种元素。**
 ` ["Al", "Ca","F", "Fe", "K", "Mg", "Na","O", "P", "S","Si", "Ti"]`
 对于不同的电镜图想要分析不同元素特征的话，需要自己增减代码中的元素标签。例如：
 *元素标签例1（共14种）：*
 `["Al","Ca","Cl","F","Fe","K","Mg","Na","Ni","O", "P","S", "Si", "Ti"]`
 *元素标签例2（共15种）：*
 `["Al","Ca","Cl","Cr","F","Fe","K","Mg","Na","Ni","O", "P","S", "Si", "Ti"]`
 *元素标签例3（共14种，与例 1不同）：*
 `["Al","Ca","Cl","F","Fe","K","Mg","Mn","Na","Ni", "P","S", "Si", "Ti"]`
 **修改方法：**
  “Ctrl”+“F”，输入“n_columns”，找到第一个“n_columns”，增减待分析的元素。（约代码1332行）
  “Ctrl”+“F”，“df = pd.DataFrame”，找到没有被注释掉的，增减待分析的元素。（共计6个，约代码1380，1428，1477，1525，1573，1621行）
- **关于高P元素区域和能量色散谱图的命名问题：**
对于“duibi”文件夹中的能量色散谱图命名一般没有要求，通常可使用某电镜图下的默认名称如“CE5***GP-X“等，但建议是单以元素命名，如：铝元素的能量色散谱图就用"Al"命名。
 代码中有单独求高P元素区域的情况，这样就需要单独导入P元素图，如果不需要可以注释掉（约代码1656-1680行），如果需要查看高P元素区域情况，您有两种选择：
             （1）在"duibi"文件夹中把“CE5***GP-P.tiff“（默认名称）改名“P.tiff”
      （2）在代码中查找“P_img2 = cv2.imread”（约1662），将其查找对象“P”改为“CE5***GP-P”（默认名称）
- **关于如何整合联系输出结果的图和表的问题：**
  打开“biaoge”文件夹的“汇总表—-密度范围.csv“或“汇总表—-密度均值.csv“。
  表格第一列为所有元素二分类结果全排列相同块号合并的编号，可以浅显理解为一类或一种矿物。
  *举个例子，如何查看编号2_9的可视化？*
  ①在表格中确认编号2_9对应灰度，其属于灰度3。
  ②打开“same_element”文件夹查看“G3”文件夹中的图。
  ③ 在"G3"中“9.png”，对应编号2_9的可视化。



## License
This project is licensed under the MIT License.  
- Full Text: [LICENSE](LICENSE)  
- Official Link: [https://opensource.org/licenses/MIT](https://opensource.org/licenses/MIT)



## 数据来源
中国科学院国家天文台
月壤样品信息数据库（moon.bao.ac.cn）
